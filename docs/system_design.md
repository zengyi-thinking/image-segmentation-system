# 图像分割系统设计文档

## 1. 项目概述

### 1.1 项目目标

实现一个基于图论的图像分割系统，使用最小生成树(MST)算法进行图像分割，并提供图形用户界面进行演示和分析。

### 1.2 核心功能

- 基于 MST 的图像分割算法
- 多种分割策略对比
- 实时参数调整
- 分割质量评估
- 可视化结果展示

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                    GUI界面层                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │  图像加载   │ │  参数设置   │ │  结果展示   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────┐
│                   算法处理层                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │  图构建     │ │  MST算法    │ │  区域合并   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────┐
│                   数据管理层                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │  图像数据   │ │  图结构     │ │  分割结果   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
└─────────────────────────────────────────────────────────┘
```

### 2.2 模块设计

#### 2.2.1 核心算法模块 (core/)

- `graph_builder.py`: 像素图构建
- `mst_segmentation.py`: MST 分割算法
- `region_merger.py`: 区域合并策略
- `edge_weights.py`: 边权重计算

#### 2.2.2 数据结构模块 (data_structures/)

- `pixel_graph.py`: 像素关系图
- `union_find.py`: 并查集实现
- `image_data.py`: 图像数据管理
- `segmentation_result.py`: 分割结果存储

#### 2.2.3 GUI 界面模块 (gui/)

- `main_window.py`: 主界面
- `image_viewer.py`: 图像显示组件
- `parameter_panel.py`: 参数控制面板
- `result_analyzer.py`: 结果分析界面

#### 2.2.4 性能评估模块 (evaluation/)

- `metrics.py`: 分割质量指标
- `performance_analyzer.py`: 性能分析
- `comparison_tools.py`: 算法对比工具

## 3. 技术选型

### 3.1 编程语言与框架

- **Python 3.8+**: 主要开发语言
- **NumPy**: 数值计算
- **OpenCV**: 图像处理
- **Matplotlib**: 数据可视化
- **Tkinter/PyQt**: GUI 框架
- **Pillow**: 图像 IO 操作

### 3.2 核心算法

- **Kruskal 算法**: MST 构建
- **Union-Find**: 连通分量管理
- **区域生长**: 分割后处理
- **颜色空间转换**: RGB/HSV/Lab

## 4. 数据结构设计

### 4.1 像素图表示

```python
class PixelGraph:
    def __init__(self, image):
        self.nodes = []      # 像素节点
        self.edges = []      # 像素间边
        self.weights = {}    # 边权重
        self.adjacency = {}  # 邻接表
```

### 4.2 分割结果存储

```python
class SegmentationResult:
    def __init__(self):
        self.segments = {}      # 分割区域
        self.labels = None      # 像素标签
        self.statistics = {}    # 统计信息
        self.metrics = {}       # 评估指标
```

## 5. 算法实现策略

### 5.1 MST 图像分割流程

1. **图构建**: 将图像像素作为节点，相邻像素间建立边
2. **权重计算**: 基于颜色差异、空间距离计算边权重
3. **MST 构建**: 使用 Kruskal 算法构建最小生成树
4. **阈值分割**: 移除权重大于阈值的边，形成连通分量
5. **区域合并**: 根据相似性合并小区域

### 5.2 权重计算公式

```
w(i,j) = α * color_diff(i,j) + β * spatial_dist(i,j)
```

## 6. 性能优化策略

### 6.1 内存优化

- 稀疏图表示
- 分块处理大图像
- 内存池管理

### 6.2 计算优化

- 多线程并行处理
- 缓存中间结果
- 算法复杂度优化

## 7. 开发计划

### 阶段 1: 核心算法实现 ✓

- ✅ 图构建算法
- ✅ MST 分割实现
- ✅ 基础数据结构

### 阶段 2: GUI 界面开发 ✓

- ✅ 主界面设计
- ✅ 图像显示组件
- ✅ 参数控制面板

### 阶段 3: 性能评估 ✓

- ✅ 评估指标实现
- ✅ 性能分析工具
- ✅ 算法对比框架

### 阶段 4: 测试与优化 ✓

- ✅ 功能测试
- ✅ 性能优化
- ✅ 文档完善

## 8. 实现状态

### 已完成功能

- 基于 MST 的图像分割算法
- 完整的 GUI 界面
- 性能评估框架
- 可视化工具
- 测试系统

### 系统特点

- 模块化设计，易于扩展
- 支持多种参数调整
- 实时可视化结果
- 完整的性能分析
- 用户友好的界面
