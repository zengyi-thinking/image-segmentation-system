# 🖼️ 智能图像分割系统 v2.0 (Image Segmentation System)

基于双算法架构的智能图像分割系统，支持 MST(最小生成树)和 Watershed(分水岭)算法，提供现代化 GUI 界面和全面的性能分析功能。

## 🌟 主要特性

### 🔬 双算法支持

- **MST 分割算法**: 基于图论的最小生成树算法，适合复杂纹理和边界
- **Watershed 分割算法**: 基于形态学的分水岭算法，适合明显边界的对象
- **算法对比分析**: 并排比较两种算法的性能和结果
- **智能参数推荐**: 基于图像特征自动推荐最佳参数

### 🎨 现代化界面

- **多主题支持**: 浅色/深色/蓝色/绿色四种主题
- **响应式布局**: 自适应窗口大小的界面设计
- **增强图像显示**: 支持缩放、拖拽、动画效果
- **实时参数调整**: 所见即所得的参数调整体验

### 📊 全面评估系统

- **标准评估指标**: IoU、Dice 系数、边界准确度等
- **性能基准测试**: 执行时间、内存使用、可扩展性分析
- **可视化对比**: 图表化展示算法性能差异
- **详细报告生成**: 自动生成分析报告

## 📁 项目架构

```
image-segmentation-system/
├── 📄 main.py                          # 主程序入口
├── 📄 quick_start.py                   # 快速启动脚本
├── 📄 requirements.txt                 # Python依赖
├── 📄 README.md                        # 项目文档
│
├── 📂 core/                            # 🔬 核心算法模块
│   ├── 📄 __init__.py
│   ├── 📄 mst_segmentation.py          # MST分割算法
│   ├── 📄 watershed_segmentation.py    # Watershed分割算法
│   ├── 📄 edge_weights.py              # 边权重计算
│   └── 📄 graph_builder.py             # 图构建器
│
├── 📂 data_structures/                 # 📊 数据结构模块
│   ├── 📄 __init__.py
│   ├── 📄 union_find.py                # 并查集实现
│   ├── 📄 pixel_graph.py               # 像素图数据结构
│   └── 📄 segmentation_result.py       # 分割结果封装
│
├── 📂 gui/                             # 🎨 图形用户界面
│   ├── 📄 __init__.py
│   ├── 📄 enhanced_main_window.py      # 增强版主窗口
│   ├── 📄 algorithm_comparison_window.py # 算法对比窗口
│   ├── 📄 performance_analysis_window.py # 性能分析窗口
│   ├── 📄 control_panel.py             # 参数控制面板
│   ├── 📄 enhanced_image_display.py    # 增强图像显示
│   ├── 📄 theme_manager.py             # 主题管理器
│   └── 📄 style_manager.py             # 样式管理器
│
├── 📂 utils/                           # 🛠️ 工具模块
│   ├── 📄 __init__.py
│   ├── 📄 image_io.py                  # 图像输入输出
│   ├── 📄 visualization.py             # 可视化工具
│   └── 📄 image_diagnostics.py         # 图像诊断工具
│
├── 📂 evaluation/                      # 📈 评估模块
│   ├── 📄 __init__.py
│   ├── 📄 metrics.py                   # 评估指标计算
│   ├── 📄 performance_analyzer.py      # 性能分析器
│   └── 📄 comparison_tools.py          # 算法对比工具
│
├── 📂 tests/                           # 🧪 测试模块
│   ├── 📄 __init__.py
│   ├── 📄 test_algorithm_comparison.py # 算法对比测试
│   ├── 📄 test_watershed_algorithm.py  # Watershed算法测试
│   └── 📄 test_cleanup_verification.py # 清理验证测试
│
├── 📂 config/                          # ⚙️ 配置文件
│   └── 📄 theme_config.json            # 主题配置
│
├── 📂 docs/                            # 📚 文档
│   ├── 📄 algorithm_comparison.md      # 算法对比文档
│   └── 📄 performance_analysis.md      # 性能分析文档
│
└── 📂 examples/                        # 🖼️ 示例文件
    ├── 📄 README.md
    ├── 📄 demo_image.png
    └── 📄 test_image.png
```

## 🔧 核心算法详解

### 🌳 MST 分割算法

```
1. 图构建阶段:
   - 将每个像素作为图的节点
   - 根据连接性(4或8)建立边
   - 计算边权重: w = α×color_diff + β×spatial_dist

2. MST构建阶段:
   - 使用Kruskal算法构建最小生成树
   - 并查集优化: 路径压缩 + 按秩合并
   - 时间复杂度: O(E log E)

3. 分割阶段:
   - 移除权重 > 阈值的边
   - 形成连通分量作为分割区域
   - 后处理: 合并小区域

4. 优化策略:
   - 自适应阈值计算
   - 内存池管理
   - 多线程并行处理
```

### 🌊 Watershed 分割算法

```
1. 预处理阶段:
   - 双边滤波去噪
   - CLAHE对比度增强
   - 梯度计算

2. 标记检测阶段:
   - 距离变换
   - 局部最大值检测
   - 种子点生成

3. 分水岭变换:
   - 模拟水流填充过程
   - 紧凑性约束
   - 边界线生成

4. 后处理阶段:
   - 小区域移除
   - 区域合并
   - 标签重排序
```

### 📐 权重计算公式

**MST 算法权重:**

```
w(i,j) = α × ||color_i - color_j||₂ + β × ||pos_i - pos_j||₂
```

**Watershed 算法梯度:**

```
gradient = √(Gx² + Gy²)
其中 Gx, Gy 为Sobel算子计算的梯度
```

## 技术栈

- **Python 3.8+**: 主要开发语言
- **NumPy**: 数值计算和数组操作
- **OpenCV**: 图像处理和计算机视觉
- **Matplotlib**: 数据可视化和结果展示
- **Tkinter**: 图形用户界面框架
- **Pillow**: 图像文件 IO 操作
- **SciPy**: 科学计算库

## 快速开始

### 🚀 一键启动（推荐）

```bash
python quick_start.py
```

这将启动交互式菜单，自动检查依赖并引导您完成设置。

### 📋 环境要求

```bash
Python >= 3.8
NumPy >= 1.19.0
OpenCV >= 4.5.0
Matplotlib >= 3.3.0
Pillow >= 8.0.0
SciPy >= 1.7.0
```

### 🔧 安装依赖

```bash
pip install -r requirements.txt
```

### 🖥️ 运行程序

**GUI 模式（推荐）:**

```bash
python main.py --gui
```

**命令行模式:**

```bash
python main.py --cli --input path/to/image.jpg --output path/to/result.png
```

## 📖 详细使用说明

### 🖼️ 图像操作

#### 加载图像

- **GUI 方式**: 文件 → 打开图像 (Ctrl+O)
- **支持格式**: PNG, JPG, JPEG, BMP, TIFF, GIF
- **中文路径**: 完全支持中文文件名和路径
- **大图像**: 自动优化大尺寸图像加载

#### 算法选择

1. **MST 算法**: 适合复杂纹理、不规则边界

   - 颜色权重(α): 0.1-5.0，控制颜色相似性重要程度
   - 空间权重(β): 0.01-1.0，控制空间距离重要程度
   - 连接性: 4-连通(快速) 或 8-连通(精确)
   - 分割阈值: 自动或手动设置

2. **Watershed 算法**: 适合明显边界、规则形状
   - 最小距离: 5-50，控制种子点间距
   - 紧凑性: 0.0001-0.01，控制分水岭紧凑度
   - 分水岭线: 是否在边界添加分割线

#### 执行分割

- **单次分割**: 点击"开始分割"按钮
- **实时预览**: 参数调整时自动更新预览
- **进度显示**: 实时显示分割进度和状态

### 📊 算法对比分析功能

#### 启动对比分析

1. **菜单访问**: 工具 → 算法对比分析
2. **自动测试**: 系统自动使用两种算法处理同一图像
3. **结果展示**:
   - 可视化对比: 并排显示分割结果
   - 性能指标: 执行时间、内存使用对比
   - 详细报告: 完整的分析报告

#### 性能基准测试

1. **启动测试**: 工具 → 性能分析仪表板
2. **配置测试**: 选择算法和测试次数
3. **结果分析**:
   - 性能概览: 关键指标卡片展示
   - 详细统计: 完整的统计数据表格
   - 性能图表: 可视化性能趋势

### 🎨 界面定制

#### 主题切换

- **浅色主题**: 适合白天使用，清晰明亮
- **深色主题**: 适合夜间使用，护眼舒适
- **蓝色主题**: 专业商务风格
- **绿色主题**: 清新自然风格

#### 快捷键操作

```
文件操作:
Ctrl+O    打开图像
Ctrl+S    保存结果
Ctrl+Q    退出程序

视图操作:
鼠标滚轮   缩放图像
+/=       放大图像
-         缩小图像
0         实际大小
F         适应窗口
R         重置视图

其他:
Tab       切换焦点
Enter     确认操作
Esc       取消操作
```

## 📊 性能评估系统

### 🎯 评估指标

#### 分割质量指标

- **IoU (Intersection over Union)**: 交并比，衡量分割准确性
- **Dice 系数**: 重叠度量，评估分割一致性
- **边界准确度**: 边界检测精确度
- **区域紧凑性**: 分割区域的形状规整度
- **分割一致性**: 相似区域的分割稳定性

#### 计算性能指标

- **执行时间**: 算法运行时间统计
- **内存使用**: 峰值和平均内存占用
- **可扩展性**: 不同图像尺寸的性能表现
- **效率分数**: 综合性能评估分数

### 📈 基准测试功能

#### 多次运行测试

- **统计分析**: 平均值、标准差、中位数
- **性能趋势**: 多次运行的性能变化
- **稳定性评估**: 算法执行的一致性
- **异常检测**: 识别性能异常情况

#### 对比分析

- **算法对比**: MST vs Watershed 性能对比
- **参数影响**: 不同参数设置的性能影响
- **图像类型**: 不同类型图像的适应性
- **可视化展示**: 图表化性能对比结果

## 🧪 测试系统

### 测试覆盖

- **算法功能测试**: 验证分割算法正确性
- **性能基准测试**: 评估算法执行效率
- **界面交互测试**: 验证 GUI 功能完整性
- **边界情况测试**: 测试异常输入处理

### 运行测试

```bash
# 运行算法对比测试
python tests/test_algorithm_comparison.py

# 运行Watershed算法专项测试
python tests/test_watershed_algorithm.py

# 运行系统清理验证测试
python tests/test_cleanup_verification.py
```

## ✨ v2.0 重大更新

### 🔬 双算法架构

- **新增 Watershed 算法**: 基于形态学的分水岭分割
- **算法对比分析**: 并排比较两种算法性能
- **智能算法推荐**: 根据图像特征推荐最佳算法
- **参数自动优化**: 基于图像内容自动调整参数

### 🎨 界面全面升级

- **多主题支持**: 4 种精美主题(浅色/深色/蓝色/绿色)
- **模块化窗口**: 独立的对比分析和性能测试窗口
- **增强图像显示**: 支持缩放、拖拽、动画效果
- **响应式布局**: 自适应不同屏幕尺寸

### 📊 全面性能分析

- **性能仪表板**: 实时性能监控和分析
- **基准测试套件**: 多次运行统计分析
- **可视化图表**: matplotlib 集成的性能图表
- **详细报告生成**: 自动生成分析报告

### 🏗️ 代码架构优化

- **模块化设计**: 将大文件拆分为功能模块
- **分离关注点**: 算法、界面、分析功能独立
- **提升可维护性**: 代码行数从 1500+行优化到 300-400 行/文件
- **增强测试覆盖**: 专项测试套件覆盖核心功能

### 🚀 性能提升

- **算法效率**: MST 算法优化，Watershed 算法新增
- **内存管理**: 优化大图像处理内存占用
- **并发处理**: 后台线程处理，界面响应更流畅
- **缓存机制**: 智能缓存提升重复操作速度

## 🚧 开发状态

### v2.0 完成功能

- [x] ✅ 双算法架构设计与实现
- [x] ✅ Watershed 分割算法集成
- [x] ✅ 算法对比分析系统
- [x] ✅ 性能基准测试框架
- [x] ✅ 多主题 GUI 界面升级
- [x] ✅ 模块化代码重构
- [x] ✅ 增强图像显示功能
- [x] ✅ 综合测试套件
- [x] ✅ 性能分析仪表板
- [x] ✅ 文档更新完善

### 🔮 未来规划

- [ ] 🔄 更多分割算法集成(GrabCut, SLIC 等)
- [ ] 🤖 机器学习辅助参数优化
- [ ] 🌐 Web 界面版本开发
- [ ] 📱 移动端适配
- [ ] 🔗 API 接口开发
- [ ] 📊 更多评估指标支持

## 📁 重要文件说明

### 核心文件

- `main.py` - 🚀 主程序入口，支持 GUI 和 CLI 模式
- `quick_start.py` - 🎯 快速启动脚本，自动环境检查

### 测试文件

- `tests/test_algorithm_comparison.py` - 🔬 算法对比功能测试
- `tests/test_watershed_algorithm.py` - 🌊 Watershed 算法专项测试
- `tests/test_cleanup_verification.py` - 🧹 系统清理验证测试

### 文档文件

- `README.md` - 📖 项目主文档(本文件)
- `docs/algorithm_comparison.md` - 📊 算法对比详细文档
- `docs/performance_analysis.md` - 📈 性能分析使用指南

### 配置文件

- `requirements.txt` - 📦 Python 依赖包列表
- `config/theme_config.json` - 🎨 主题配置文件

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进项目。

## 许可证

MIT License
